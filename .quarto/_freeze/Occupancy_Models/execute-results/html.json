{
  "hash": "8583c67b1a6dc764a502bce08db951d7",
  "result": {
    "markdown": "---\ntitle: \"Introduction to Occupancy Models\"\nauthor: \"Deon Roos\"\ndate: \"2025-05-03\"\nformat:\n  html:\n    theme: flatly\n    highlight-style: monochrome\n    code-fold: true\n    toc: true\n    toc-depth: 2\n    toc-location: right\n---\n\n\n\n\n# Where are species present and why are they present?\n\nA fundamental question in ecology is; Where are species present, and why are they present *there*?\n\n> **Zitong**, in your case this may be; Why are roe deer present at site A but not site B? Is it because site A is closer to roads? If a site is close to a road what's the probability roe deer are present? Is that very different to sites that are far away from a road?\n>\n> What about features of the habitat? Are roe deer more likely if a site is forested versus agricultural?\n\n> **Joe**, in your case this may be; Why are pheasants present at site A but not site B? Is it related to how far away the nearest *known* release pen is? What does the relationship look like? If there is no relationship, what would that mean for policy?\n>\n> What about the habitat makes pheasants more likely to occupy that site?\n\nTo act as motivation for this intro to occupancy models, let's say we're interested in understanding why are elephants present in the north of [Etosha](https://www.etoshanationalpark.org/) nature reserve in Namibia, but not in the south of the reserve? (As a side note, I'd recommend going there on holiday if you ever get the chance). Are elephants present in some parts of Etosha due to water availability? Is it related to food? Could predators play a role?\n\nTo find out, we need stats. As useful as gut feelings and intuition are, it's not enough. Remember, *statistics is how we get the **evidence*** *to answer our research question using data*.\n\nThe best statistical tool available for answering these types of questions are \"occupancy modeling\". These were originally developed by Daryl MacKenzie et al in [2002](https://doi.org/10.1890/0012-9658(2002)083%5B2248:ESORWD%5D2.0.CO;2) who wanted to deal with a subtle issue when trying to find animals (more on this in a second). The broad concept underlying MacKenzie's occupancy modelling framework built on ideas that had already been developed for estimating *survival* *of* *individual* animals, called the Cormack-Jolly-Seber, or CJS, model. As a cool note; Cormack and Jolly independently developed this model *while they worked in Aberdeen University* - a vital and internationally renowned model was developed right here in bloody Aberdeen! In my entire time as an undergraduate student, then as a PhD *in Aberdeen* no one ever told me this (even though I was taught these methods in Aberdeen)! I only found out at a conference in France years after leaving Aberdeen. As a school, we should be far more proud of this than we are.\n\nThe problem that occupancy models solve is subtle, yet absolutely crucial. Occupancy models estimate the probability a species occupies a site, **and also** the probability that you see them.\n\nAssume I want to determine where elephants are present in Etosha nature reserve in Namibia. I need data to answer this, so I decide to do ten elephant surveys in Etosha. Specifically, I go to visit these ten sites that are nicely spread throughout the park. At each site, whenever I spot an elephant I note down that elephants are present at that location. When I don't see any elephants I record that elephants are absent at that location. Simple, right?\n\nLet’s imagine we collect data across ten sites. Here’s what our dataset might look like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1988)\netosha <- data.frame(\n  site = 1:10,\n  elephants = rbinom(n = 10, size = 1, prob = 0.4)\n)\netosha\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   site elephants\n1     1         0\n2     2         0\n3     3         0\n4     4         0\n5     5         0\n6     6         0\n7     7         0\n8     8         1\n9     9         1\n10   10         0\n```\n:::\n:::\n\n\nWhen `elephants` is `1`, it means elephants were seen at that site; when it's `0`, they were not. So, `1` indicates presence, and `0` indicates absence; at least for now.\n\nTo figure out the average probability that any one of my ten sites are occupied, I can run a Bernoulli Generalised Linear Model. The Bernoulli distribution (named after [Jacob Bernoulli](https://en.wikipedia.org/wiki/Jacob_Bernoulli)) generates values of `1` or `0`, which is perfect for our binary presence–absence data.\n\nThe model would be:\n\n$$\ny_i \\sim Bernoulli(p_i) \\\\\n$$\n\n$$\nlogit(p_i) = \\beta_0\n$$\n\nLet's go through these equations slowly:\n\n-   $y$ is our observation (`elephants` in the `etosha` dataset)\n\n-   $i$ is the index, here being which `site` the data was collected from\n\n-   $\\sim$ means \"generated according to\" (or \"our data is the same as would be generated by the following distribution\")\n\n-   $Bernoulli$ is a type of distribution that will generate either 0 or 1\n\n-   $p$ is the probability of success (i.e. there is $p$ probability that we see an elephant). We can't possibly know what $p$ is when we collect the data, so we need to figure it out with statistics. (The $i$ means each site *could* have a different probability - but we're not doing that yet)\n\n-   $logit$ is the link function to ensure that $p$ remains between 0% and 100%. Specifically, it's a little bit of maths: $log(\\frac{p}{1-p})$, which is the natural log of the probability to succeed ($p$) divided by the probability to fail ($1-p$). More on this in a second.\n\n-   $\\beta_0$ is the intercept. Since we haven’t included any covariates (yet), it captures the average logit value of elephant presence across all sites. When converted back from the logit scale, this will give us the average probability of elephant presence.\n\nTo understand how the logit link transforms probabilities, have a look at this figure. It maps the full range of probabilities (0% to 100%) to the logit scale.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- seq(from = 0, to = 1, by = 0.001)\nlogit <- log(p/(1-p))\ndat <- data.frame(p, logit)\nlibrary(ggplot2)\nggplot(dat) +\n  geom_line(aes(x = logit, y = p)) +\n  labs(x = \"Logit value that\\nelephants are present\",\n       y = \"Probability that\\nelephants are present\") +\n  scale_y_continuous(labels = scales::percent) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Occupancy_Models_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nNotice how as the probability approaches 0%, it never actually drops below it, even as the logit value keeps decreasing? And the same happens when it gets close to 100%. And that’s exactly what we want. The fact that logit values can range from $-\\infty$ to $+\\infty$ makes model fitting much easier: it turns a bounded probability into an unbounded scale, allows linear relationships with predictors, and ensures valid probabilities when converting predictions back. So even if our model estimates a logit value of 999 billion, it still maps to a probability of 100%. This ensures the natural bounds of probability, which is between 0% and 100%, are always respected.\n\nIf you want a bit more detail and intuition, here is an old lecture recording that covers the logit link function:\n\n<iframe src=\"https://abdn.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=dea0921b-d1ce-49f4-84b9-acb700ef650f\" width=\"720\" height=\"405\" allowfullscreen></iframe>\n\nWith that in mind, here’s how we’d fit our model in `R`. (Click `Code` to reveal the code.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- glm(elephants ~ 1,\n           data = etosha,\n           family = binomial(link = \"logit\"))\n```\n:::\n\n\nThis estimates $\\beta_0$, the average probability of elephant presence, but on the logit scale. We can see what it has been estimated as by looking at the summary of the model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = elephants ~ 1, family = binomial(link = \"logit\"), \n    data = etosha)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)  \n(Intercept)  -1.3863     0.7906  -1.754   0.0795 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 10.008  on 9  degrees of freedom\nResidual deviance: 10.008  on 9  degrees of freedom\nAIC: 12.008\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\nThe estimate for `(Intercept)` (or $\\beta_0$) is `-1.3863`. Now that we have an estimate for $\\beta_0$, we can plug it into our model:\n\n$$\ny_i \\sim Bernoulli(p_i) \\\\\n$$\n\n$$\nlogit(p_i) = -1.3863\n$$\n\nTo interpret this on the probability scale, we apply the inverse logit transformation using `plogis()` in `R`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplogis(-1.3863)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1999991\n```\n:::\n:::\n\n\nThis gives us a probability of approximately 0.2, or 20%, meaning there’s a 20% chance a site is occupied by elephants.\n\nOr does it?\n\n# Imperfect detection\n\nThat 20% estimate isn’t as straightforward as “there’s a 20% chance a site has elephants.” It’s actually the result of two probabilities being multiplied together. For us to detect an elephant and get a `1` in the `etosha` dataset, two things need to happen.\n\n1.  The elephant must obviously be there, with some probability. We can call this probability $\\psi$ (called \"psi\", pronounced like \"sigh\").\n\n2.  I also have to *see* the elephant, and no matter how good I am, that probability is almost certainly never going to be 100%. We normally call this probability $p$.\n\nSo all of the `1`'s in our `etosha` dataset are the result of succeeding in both of these probabilities. But a `0` could be the result from **either** of two failures:\n\n1.  either there truly were no elephants ($1 - \\psi$ - remember $\\psi$ is the probability there are elephants, e.g. 20% or 0.2, in which case $1-0.2 = 0.8$ or 80% chance there are no elephants),\n\n2.  or elephants were present but we didn’t detect them ($\\psi \\times (1 - p)$ - remember that $p$ is the probability to detect a species, so if $\\psi = 0.2$ and $p = 0.6$, then the probability to **not** see them is $0.2 * (1 - 0.6) = 0.08$, or \"there is an 8% chance elephants are present but not detected).\n\nFundamentally, the problem is that the data in the `elephants` column of our `etosha` dataset represents $\\psi \\times p$, and not just $\\psi$ like we want.\n\nFor example, here's a picture from BI3010 that you might remember. I've added a white line to show where the elephant is almost perfectly obscured by an acacia tree. If this was at one of our sites in `etosha`, then we'd have recorded `0` (or said `Absent`) despite it being there.\n\n![](images/occupancy.PNG)\n\nThere's no shortage of reasons why you might not see an elephant despite it being there. It can be as simple as the elephant was behind a bush when I checked that site. Or, if we were using cameras, it might be that the motion sensor didn't trigger. Or it might be that the elephant was behind the camera. This process of an animal being present but us not seeing it reflects something called *imperfect detection*, i.e. just cause it's there doesn't mean we're guaranteed to see it.\n\n*Imperfect detection* is not an issue for the `1`'s in our `etosha` data.\n\n-   If you see an elephant, you know there was an elephant present. That's easy and obvious.\n\n-   The complication happens when we ***don't*** detect an elephant; when `elephants` is `0`.\n\nThat’s the key problem: a `0` in the data doesn’t always mean “no elephants”, it could just mean we missed them.\n\nOccupancy models don’t ignore this, they’re built to handle it. They allow us to estimate two things separately: the probability that a site is occupied ($\\psi$), and, if it is, the probability of detecting the species ($p$).\n\nThat’s why they’re such a powerful tool. Here’s how they do it.\n\n# Occupancy models\n\n## State model\n\nThe first part of an occupancy model is the *state model*, so called because it estimates the true state of each site: is the species present or absent?\n\n$$\nz_i \\sim Bernoulli(\\psi_i)\\\\\n$$\n\n$$\nlogit(\\psi_i) = \\beta_0\n$$\n\nThis model probably looks similar. That's because like the first model we spoke about further above, it's also a $Bernoulli$ GLM. But they differ in two important ways:\n\n-   $z$ is the **true** presence or absence of elephants in site $i$ (this isn't $y$)\n\n-   $\\psi$ is the probability to be present\n\nThat's nice and all but just changing the labels doesn’t fix imperfect detection. To solve that, we need a second model: the *observation model*.\n\n## Observation model\n\nThe second GLM (which I'll call the *observation model*) also looks remarkably similar:\n\n$$\ny_{i,j} \\sim Bernoulli(p_{i,j} \\times z_i)\\\\\n$$\n\n$$\nlogit(p_{i,j}) = \\alpha_0\n$$\n\nIt's another $Bernoulli$ GLM but with some crucial differences.\n\n-   $y$ is now the **detection** or not of an elephant. This is worth highlighting - $y$ is **not** the presence or absence of elephants, it's the detection of elephants **if** they're present!\n\n-   $j$ represents which *survey* $y$ was collected in, which inherently means we have *multiple surveys*, not just one like in our first GLM example above where $i$ was a single (of ten) sites. This has implications for how we collect data, which we'll come back to.\n\n-   $p$ is the probability to detect an elephant at site $i$ in survey $j$ (e.g. what is the probability to detect an elephant in site 1 in the third survey?)\n\nImportantly, the probability to detect elephants ($p$) is *multiplied* by $z$. What's $z$? Well that's the true occupancy state of that site from the *state model*. It's this multiplication that allows the two models to \"speak\" to each other, and how we deal with imperfect detection; it ensures the *observation process* depends on whether the species is actually present.\n\nIf there are elephants in a site ($z = 1$), then $p \\times z = p \\times 1 = p$. If elephants are absent from a site ($z = 0$), then $p \\times z = p \\times 0 = 0$. This means *you cannot detect elephants if they aren't there*. That's blindingly obvious... It's so dumb that most people don't realise you need to specify it (I've heard people say: \"surely any model can figure this out?\"). But this stupidly simple logic is missing from our starting GLM! And a lot of research asking about where species are use a model equivalent to the very first GLM on this page.\n\n> Keep in mind that we don't know $z$. That’s the true occupancy state, a *latent variable*. Latent just means it’s unobserved: we can’t measure $z$ directly in the field, but we can estimate it using the data we collect, much like we do with parameters.\n\nThat's how occupancy models \"know\" that you can only detect elephants if they're present, and that if they’re absent, you won’t detect them. It seems so obvious, yet this logic is missing from many models that treat non-detections as true absences.\n\nAnd that’s the beauty of occupancy models. They handle the messy reality of ecological data (but can also be used in e.g. medicine), and that’s why they’re one of my favorite types of analysis.\n\n# The robust design and closure\n\nSo, we have a clever modeling framework, but how does it help when we go to a site and don’t see any elephants? How can we tell the difference between a true negative (the site was genuinely unoccupied) and a false negative (elephants were present, but we missed them)?\n\nThis is where the subscript $j$ in the observation model becomes important. If you only visit a site once and don’t see any elephants, you’re left guessing. With no extra information, you can’t know whether the site was unoccupied or whether you simply failed to detect them.\n\nBut imagine I went back to that same site the next day. This time I do see elephants. We learn a few things from this. First, we know elephants are present at the site. Secondly, we learn that the first survey must have been a false negative - we just didn't see elephants despite them being there.\n\nNow imagine we scale this up by repeating this process where we now survey each of the ten sites three times. What might that data look like?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1988)\npsi <- 0.5\nN <- 10\np <- 0.8\nz <- rbinom(N, size = 1, p = psi)\ny <- matrix(ncol = 3, nrow = N, data = 0)\n# Specifying y manually so it's easier to use in text\n# for (i in 1:N){ # For each site\n#   for (j in 1:3) { # For each survey\n#     y[i, j] <- rbinom(1, 1, prob = z[i] * p)\n#   } # survey j\n# } # site i\ny[1,1] <- 1\ny[8,3] <- 1\ny[9,2] <- 1\netosha <- as.data.frame(y)\netosha$site <- 1:10\ncolnames(etosha) <- c(\"Survey 1\", \"Survey 2\", \"Survey 3\", \"Site\")\netosha <- etosha[, c(\"Site\", \"Survey 1\", \"Survey 2\", \"Survey 3\")]\n\n\nlibrary(knitr)\nlibrary(kableExtra)\nhighlight_ones <- function(x) {\n  ifelse(x == 1,\n         cell_spec(x,\n                   color = \"white\",\n                   background = \"darkred\",\n                   bold = TRUE),\n         x)\n}\n\netosha_kbl <- etosha\netosha_kbl[, 2:4] <- lapply(etosha_kbl[, 2:4], highlight_ones)\n\nkable(etosha_kbl, \"html\", escape = FALSE) |> \n  kable_styling(full_width = FALSE, bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> Site </th>\n   <th style=\"text-align:left;\"> Survey 1 </th>\n   <th style=\"text-align:left;\"> Survey 2 </th>\n   <th style=\"text-align:left;\"> Survey 3 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> <span style=\" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkred !important;\">1</span> </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> <span style=\" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkred !important;\">1</span> </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> <span style=\" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkred !important;\">1</span> </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nBy surveying each site three times, we gain crucial extra information to help account for imperfect detection.\n\nWe detect elephants in three sites:\n\n-   Site 1 in survey 1\n\n-   Site 8 in survey 3\n\n-   Site 9 in survey 2\n\nFrom this, we know there are definitely elephants in sites 1, 8 and 9. But we also learn some additional information that's going to be very useful. In sites 1, 8 and 9, we see elephants only once out of three attempts in each site. Since we *know* elephants are present at those sites (we saw them at least once), and yet we only detected them in 1 out of 3 visits, we can estimate detection probability as roughly 30%.\n\nNow let’s consider a site where we never detected elephants, say, site 2. What’s the chance that elephants were actually there, but we just missed them every time? Well, we've manually estimated our detection probability at 30% meaning the probability not to detect them is 100% - 30%, or 1-0.3, so the probability **not to detect** them on every single one of the three surveys is:\n\n$$(1-0.3) \\times (1-0.3) \\times (1-0.3) = (1-0.3)^3=0.343=34\\%$$\n\nSo even if elephants are present, there’s a 34% chance we’d miss them on all three surveys. That’s not trivial and it shows how easily a site could look empty even when it’s not.\n\nThis introduces a key assumption in occupancy models. But for that 30% detection probability to be meaningful, we must make an important assumption, called the *closure assumption*. This means we assume that if a site is occupied, it was occupied for all three surveys. In other words, the `0`s in sites 1, 8, and 9 were false negatives and not times when the elephants just happened to leave that site for a day. For example, we assume the elephants in site 8 didn’t just wander in before the third survey; they *were* there during the first and second surveys too.\n\n# The assumption of closure\n\nThis is known as the *assumption of closure* (or *closure assumption*). It’s often misunderstood as meaning the site is physically “closed” off by something like a fence to prevent animals from entering and leaving. That’s not what it means. In occupancy models, closure means the population is demographically closed during the survey period. If a species is present at the first survey, it remains present for all subsequent surveys.\n\n> **Zitong** and **Joe**, this has two important implications for your fieldwork:\n>\n> You need to survey each site on multiple occasions, i.e. you need $J$ surveys. If you’re using camera traps, this means leaving the camera in situ for more than one sampling period.\n>\n> You're completely free to define the sampling period (hour/day/week), but it must be short enough that if your species is present at the first survey, it’s still present at the last.\n\nAnd, critically, the full survey period should not be so long that the species could realistically disappear from the site (e.g. due to death, migration, or disturbance) or recolonise it.\n\nIn practice, you need at least three survey occasions to estimate detection probability reliably. These could be three days, three 12-hour periods—whatever matches your chosen sampling unit. More surveys are great (e.g. two weeks of camera trapping), but be cautious: surveying over too long a period risks violating closure if the species could move in or out of the site (or go locally extinct or recolonise a vacant site).\n\nThis approach, repeatedly surveying the same site at least three times within a “closed” window, is called the robust design. It's the backbone of reliable single-season occupancy modeling, and something you should aim to implement whenever possible.\n\n# The data\n\nI’m going to simulate data for an occupancy model to show you how your data should be structured, and to give you something to practise with. We’ll use the `spOccupancy` package in `R` which you’ll also use in your own analysis. It stands for *spatial occupancy*, but we’ll focus on the *occupancy* part for now and save the *spatial* component for later.\n\n> On the next page ([Occupancy Models: Covariates](OccMods_WithCovariates.qmd)), I’ll explain how to include environmental or site-level covariates, like distance to a road or release pen. For now, we’ll leave those out to keep things simple.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spOccupancy)\nset.seed(1234)\ndat <- simOcc(J.x = 5, J.y = 2, n.rep = rep(3, times = 10), beta = c(1), alpha = c(0))\nobs <- dat$y\nobs\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      [,1] [,2] [,3]\n [1,]    0    1    0\n [2,]    0    0    1\n [3,]    0    0    0\n [4,]    0    0    0\n [5,]    0    1    1\n [6,]    1    1    0\n [7,]    1    0    1\n [8,]    0    0    0\n [9,]    0    1    0\n[10,]    0    1    1\n```\n:::\n:::\n\n\nEach column represents a survey occasion (we have three here), and each row corresponds to a site (ten total). Your dataset might have more or fewer rows/columns depending on your study, but the core format, called a *detection history matrix* or just *detection matrix*, will look something like this.\n\nLet's do the same thing that we did above, but with this more sensibly simulated dataset.\n\n1.  In sites 3, 4, and 8, we never detect elephants. With no further information, we can’t say whether that’s because they were truly absent, or present but undetected.\n\n2.  In sites 1, 2, 5, 6, 7, 9, and 10, we see elephants at least once, so we know for sure that they are present there.\n\n3.  In site 5, the detection history is `0`, `1`, `1`. So, if elephants were present for all surveys (closure assumed), we detected them in 2 out of 3 attempts, suggesting an estimated detection probability of about 66%.\n\nArmed with this 66% detection probability, we can ask: *If elephants were present at a site, what’s the chance we’d fail to detect them on all surveys?*\n\nLet’s assume elephants were present at site 3. The probability of **not detecting** them on a single day is:\n\n$$1-0.66 = 0.34$$\n\nThen the probability of failing to detect them three days in a row is:\n\n$$0.34 \\times 0.34 \\times 0.34 = 0.34^3 = 0.04 or 4\\%$$\n\nSo, if elephants *were* present, there’s only a 4% chance we’d miss them all three times. That’s pretty unlikely, so we might reasonably infer that site 3 was truly unoccupied.\n\nAnd since this is simulated data, we can check the truth; we know whether elephants were really there or not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat$z[3]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n:::\n\n\nWe see that elephants were absent in site 5. The output above should read `[1] 0`, which means absence. Our guess was correct. It was more likely that elephants were simply not there, rather than being present and somehow undetected every time.\n\nThis is essentially how occupancy models work. But instead of using a single site and a rough estimate of detection probability, we use all of our data across all sites and surveys. The occupancy model then estimates both the probability that a site is occupied and the probability of detecting the species when it is present.\n\n# Data preparation\n\nBefore getting to running a fancy model, we need to get our dataset organised in a format that works for `spOccupancy`. Unlike linear models or GLMs, which typically use a simple `data.frame` to supply the data, `spOccupancy` expects a `list` object. This list can (and often will) contain *multiple* datasets and nested lists.\n\nFor the basic model we’ll fit below, we only need to include the *detection history matrix* - the one we used above. We’ll store this in a list called `etosha`.\n\nSo at this stage, we're simply placing our existing *detection history matrix* into a list. It might seem like an unnecessary step now, but it becomes essential when we expand to more complex models with covariates, spatial structure, or hierarchical components.\n\nHere’s the detection history matrix again, which we’ll use as input:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat$y\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      [,1] [,2] [,3]\n [1,]    0    1    0\n [2,]    0    0    1\n [3,]    0    0    0\n [4,]    0    0    0\n [5,]    0    1    1\n [6,]    1    1    0\n [7,]    1    0    1\n [8,]    0    0    0\n [9,]    0    1    0\n[10,]    0    1    1\n```\n:::\n:::\n\n\nCreating the `etosha` list is actually quite straightforward. We use the `list()` function in R to build the list and include only our detection history matrix (for now).\n\nIn this example, the detection data is stored as `dat$y` (since it was simulated), and we’ll assign that to an element called `y` inside our new list. By convention we call it `y` to match the notation from our model equations above. \n\n>An important note, even though I'm using `dat$y` in the code here, for your own data, you will most likely have a single dataset that you would load in with e.g. `read.csv()`.\n\nIf you want to see the code, click the `Code` button to the left.\n\n\n::: {.cell}\n\n```{.r .cell-code}\netosha <- list(\n  y = dat$y\n)\n```\n:::\n\n\n# Fitting the model\n\nBelow we're going to fit the simplest version of an occupancy model that we can, specifically:\n\n$$z_i \\sim Bernoulli(\\psi_i)\\\\$$\n\n$$logit(\\psi_i) = \\beta_0\\\\$$\n\n$$y_{i,j} \\sim Bernoulli(p_{i,j} \\times z_i)\\\\$$\n\n$$logit(p_{i,j}) = \\alpha_0$$\n\nThis version of the model only has two average probabilities. One for the average probability that elephants occupy a site ($\\beta_0$, which is fit on the *logit* link function), and another for the average probability of detecting elephants *if* they are present ($\\alpha_0$, also fit on the *logit* link function).\n\nThe model is not fit using the so-called *frequentist framework*. Instead, it uses the *Bayesian* framework. I'll gloss over what frequentist and Bayesian mean (and how they differ) for now, except to note that maybe 95% ($\\leftarrow$ lousy stats joke) of scientists use the frequentist framework. Not by coincidence, it's also the framework most commonly taught to students (which is partly why it's so widely used). \n\nFor your future, keep in mind that many employers, rightly or wrongly, see Bayesian statistics as fancier and more sophisticated. It's something worth including in your CV if you apply for quantitative jobs or PhDs.\n\nThe code below uses the `PGOcc()` function from the `spOccupancy` package to fit a single species, single season occupancy model with no explanatory variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- PGOcc(\n  # The state model (i.e. what % that elephants are present?)\n  # ~ 1 means we want an intercept only model (no covariates)\n  occ.formula = ~ 1, \n  # The observation model (i.e. what % that we see elephants if present?)\n  # ~ 1 means the same as above - intercept only\n  det.formula = ~1, \n  # Our carefully formatted dataset\n  data = etosha, \n  \n  # Details to get the machinery to run that we'll ignore for now\n  n.chains = 4,\n  n.samples = 2000,\n  n.burn = 200,\n  verbose = FALSE)\n```\n:::\n\n\nHaving fit the model, we can inspect the parameter estimates:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nPGOcc(occ.formula = ~1, det.formula = ~1, data = etosha, n.samples = 2000, \n    verbose = FALSE, n.burn = 200, n.chains = 4)\n\nSamples per Chain: 2000\nBurn-in: 200\nThinning Rate: 1\nNumber of Chains: 4\nTotal Posterior Samples: 7200\nRun Time (min): 0.0025\n\nOccurrence (logit scale): \n              Mean     SD    2.5%    50%  97.5%   Rhat  ESS\n(Intercept) 1.4601 0.9914 -0.1904 1.3426 3.7274 1.0065 1576\n\nDetection (logit scale): \n               Mean     SD    2.5%     50%  97.5%   Rhat  ESS\n(Intercept) -0.1952 0.4643 -1.0869 -0.2025 0.7266 1.0039 3274\n```\n:::\n:::\n\n\nThere's a lot of information in this summary, but we only really care about a few things.\n\n- `Occurrence (logit scale)`. This refers to the state model, which estimates the probability that an elephant is present at any given site.\n\n- `Detection (logit scale)`. This refers to the observation model, which estimates the probability that an elephant is detected in any given survey, assuming they were present.\n\n- The `(Intercept)` rows contains all the information on the intercept for the respective model. Since we only included an intercept in both models, this is the only row for both the state and observation models.\n\n- `Mean` is the mean of the *posterior*. This is Bayesian terminology for the distribution of the parameter estimate. (It's a bit more complicated than that, but we’ll return to Bayesian ideas later.)\n\n- `SD` is the standard deviation of the posterior.\n\n- `2.5%` is the lower bound of the 95% *credible interval*. This is not a confidence interval, but for now you can think of it as similar.\n\n- `50%` is the median of the posterior.\n\n- `97.5%` is the upper bound of the 95% credible interval.\n\n- `Rhat` is likely new to you. It helps assess whether the model had any issues estimating the posterior. If `Rhat` is close to 1, it suggests no issues were detected. (Note: this does not guarantee the model is correct, only that it appears stable.) If `Rhat` is higher than about 1.1, the model may not have converged properly and might need to be adjusted.\n\n- `ESS` stands for *Effective Sample Size*. This is another Bayesian diagnostic. For now, we want this value to be in the hundreds or ideally thousands. A low ESS suggests estimation problems and might also require model adjustments.\n\nIn our case, everything looks fine. The `Rhat` values are close to 1 and the `ESS` values are all in the thousands. We can now move on to interpreting the results biologically.\n\n# Interpreting the results\n\nSo what do our results mean?\n\nFor the state model (labelled `Occurrence` in the `spOccupancy` output), the estimated mean is 1.4601. But we would expect this to be a probability, right? Remember, we are fitting a Bernoulli GLM with a logit link. That means 1.4601 is on the *logit* scale.\n\nWe can convert this logit value to a probability using the same inverse logit function we used earlier. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nplogis(1.4601)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.811548\n```\n:::\n:::\n\n\nWhen we do that, we get a value of approximately 0.81, or 81%. So, the model estimates there is about an 80% chance that any given site is occupied by elephants.\n\nNow compare that to the observed data. In our detection history, we only saw elephants in 70% of the sites. That might seem inconsistent at first, but this is exactly where the detection part of the model helps us. Because we do not have perfect detection, we expect the *true* occupancy rate to be higher than what the raw data suggests.\n\nWhat about detection probability?\n\nThe mean of the intercept for detection is estimated (also on the logit scale) as -0.1952. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nplogis(-0.1952)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4513544\n```\n:::\n:::\n\n\nConverting that to a probability gives us about 45%. So, on average, if an elephant is present at a site, we have about a 45% chance of detecting it during any one survey.\n\nIf our detection probability is 45%, then the chance of missing an elephant on all three visits to a site is:\n\n$$\n(1 - 0.45)^3 = 0.55^3 = 0.17 = 17\\%\n$$\n\nThat is not a huge chance, but it is not trivial either. In other words, even when elephants are present, there is a meaningful chance we might not see them at all in the data.\n\nThe key takeaway is this: detection probability is not 100%. That single fact makes the Bernoulli GLM we started with right at the start of this page inappropriate. Because it ignores imperfect detection, it produces unreliable estimates. The occupancy model, by contrast, accounts for detection error and gives us a more trustworthy result.\n\n# What next?\n\nThere are three big elements this document has not yet covered.\n\n### 1. Including covariates\n\nJust like in the modelling you did in BI3010, we can add covariates that we believe influence *either* the *state model* (why elephants are present) or the *detection model* (how likely we are to see them). \n\nDo you think rainfall affects the likelihood of detecting elephants? Then include rainfall as a covariate in the detection model. Do you think distance to water affects where elephants choose to be? Then include that in the state model. This lets us link occupancy and detection to real ecological or observational factors.\n\n### 2. Bayesian statistics\n\nVery simply, Bayesian statistics allows us to include our prior understanding of the world into the model. For example, we might believe that a reasonable range for the probability of elephant presence is between 20% and 90%. That is, we don't think it is likely that *none* of the sites are occupied, and we also don't believe *all* of them are.\n\nThese informed guesses are formally called *priors*. Priors are the foundation of Bayesian inference and do not exist in frequentist statistics. They allow us to combine prior knowledge with the data we collect to produce more informed estimates.\n\n### 3. Spatial autocorrelation\n\nImagine one site is an elephant utopia. It has everything an elephant could ever want and is almost certainly occupied. Now consider a nearby site that is less ideal. On its own, we might expect a lower probability of occupancy. But because it is close to elephant utopia, it is more likely to be occupied than its local features alone would suggest.\n\nThis is an example of **spatial autocorrelation**. The occupancy of one site can influence the occupancy of nearby sites, depending on how close they are. If we ignore spatial autocorrelation, we risk drawing misleading conclusions. For example, we might falsely assume that the non-utopian site is attractive to elephants when in fact, its occupancy is driven by its proximity to a better site.\n\nFailing to account for spatial structure can lead to flawed inference. Fortunately, occupancy models can be extended to handle this, and the `spOccupancy` package is designed with this in mind.\n\n# Lecture recording\n\nBelow is an old recording of a lecture (from during the COVID lockdown) I gave that covers some of these ideas (in slightly less detail).\n\n<iframe src=\"https://abdn.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=3a68620b-f38d-467e-b791-acb701020d5e\" width=\"720\" height=\"405\" allowfullscreen></iframe>\n",
    "supporting": [
      "Occupancy_Models_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}